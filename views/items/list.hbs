<div class="panel panel-black">
    <div class="panel-body">
        <a class="add_link" data-toggle="modal" data-target="#upsertModal" href=""><i class="fa fa-4x fa-plus-circle"></i></a>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Product</th>
                    <th>Brand</th>
                    <th class="hidden-sm hidden-xs">Weight</th>
                    <th class="hidden-sm hidden-xs">Unit</th>
                    <th class="hidden-xs">Items</th>
                    <th class="hidden-xs">Item Cost</th>
                    <th>Total Cost</th>
                    <th class="hidden-xs">Address</th>
                    <th class="hidden-md hidden-sm hidden-xs">Type</th>
                    <th class="hidden-xs">Category</th>
                    <th class="hidden-md hidden-sm hidden-xs">Currency</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {{#list}}
                <tr id="{{_id}}">
                    <td><i class="{{status}}"></i>&nbsp;{{#if date}} {{dateFormat date "YYYY-MM-DD" true}} {{/if}}
                    </td>
                    <td>{{product}}</td>
                    <td>{{brand.name}}</td>
                    <td class="hidden-sm hidden-xs">{{weight}}</td>
                    <td class="hidden-sm hidden-xs">{{unit}}</td>
                    <td class="hidden-xs">{{units_bought}}</td>
                    <td class="hidden-xs">{{item_cost}}</td>
                    <td>{{totalItemCost}}</td>
                    <td class="hidden-xs">{{address.fullAddress}}</td>
                    <td class="hidden-md hidden-sm hidden-xs">{{type}}</td>
                    <td class="hidden-xs">{{category}}</td>
                    <td class="hidden-md hidden-sm hidden-xs">{{currency}}</td>
                    <td><a id="del-link" data-id="{{_id}}" href=""><i class="fa fa-trash"></i></a>&nbsp;<a id="update-link" data-id="{{_id}}" href=""><i class="fa fa-pencil"></i></a>
                    </td>
                </tr>
                {{/list}}
            </tbody>
        </table>
    </div>
</div>

<!-- Modal -->
<div id="upsertModal" class="modal fade" role="dialog">
    <form class="form-horizontal" enctype="application/x-www-form-urlencoded" action="" method="post">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
            <div class="modal-header">
                Item upsert
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title"></h4>
            </div>
            <div class="modal-body">
                <input type="hidden" name="id" id="id" />
                <div class="form-group">
                    <div class="col-lg-3">
                        <label for="date" class="control-label">Date</label> 
                        <input class="form-control" type="date" placeholder="date" name="date" id="date" value="" />
                    </div>
                    <div class="col-lg-3">
                        <label for="product" class="control-label">Product</label>
                        <input class="form-control" placeholder="product" name="product" id="product" value="" />
                    </div>
                    <div class="col-lg-2">
                        <label for="brand" class="control-label">Brand</label>
                        <select class="form-control" name="brand" id="brand">
                            {{#brands}}
                                <option value="{{this._id}}">{{this.name}}</option>
                            {{/brands}}
                        </select>
                    </div>
                    <div class="col-lg-2">
                        <label for="upp" class="control-label">UPP</label>
                        <input class="form-control" placeholder="upp" name="upp" id="upp" value="" />
                    </div>
                    <div class="col-lg-2">
                        <label for="weight" class="control-label">Weight</label>
                        <input class="form-control" placeholder="weight" name="weight" id="weight" value="" />
                    </div>
                    <div class="col-lg-2">
                        <label for="unit" class="control-label">Unit</label>
                        <select class="form-control" name="unit" id="unit">
                            {{#units}}
                                <option>{{this}}</option>
                            {{/units}}
                        </select>
                    </div>
                    <div class="col-lg-2">
                        <label for="units_bought" class="control-label">Items</label>
                        <input class="form-control" placeholder="items qty" name="units_bought" id="units_bought" value="" />
                    </div>
                    <div class="col-lg-2">
                        <label for="unit_cost" class="control-label">Unit cost</label>
                        <input class="form-control" placeholder="unit cost" name="unit_cost" id="unit_cost" value="" />
                    </div>
                    <div class="col-lg-2">
                        <label for="item_cost" class="control-label">Cost</label>
                        <input class="form-control" placeholder="item cost" name="item_cost" id="item_cost" value="" />
                    </div>
                    <div class="col-lg-2">
                        <label for="reason" class="control-label">Reason</label>
                        <select class="form-control" name="reason" id="reason">
                            {{#reasons}}
                                <option>{{this}}</option>
                            {{/reasons}}
                        </select>
                    </div>
                    <div class="col-lg-2">
                        <label for="currency" class="control-label">Currency</label>
                        <select class="form-control" name="currency" id="currency">
                            {{#currencies}}
                                <option>{{this}}</option>
                            {{/currencies}}
                        </select>
                    </div>
                    <div class="col-lg-6">
                        <label for="address" class="control-label">Address</label>
                        <select class="form-control" name="address" id="address">
                            {{#addresses}}
                                <option value="{{this._id}}">{{this.fullAddress}}</option>
                            {{/addresses}}
                        </select>
                    </div>
                    <div class="col-lg-2">
                        <label for="type" class="control-label">Type</label>
                        <select class="form-control" name="type" id="type">
                            {{#types}}
                                <option>{{this}}</option>
                            {{/types}}
                        </select>
                    </div>
                    <div class="col-lg-2">
                        <label for="category" class="control-label">Category</label>
                        <select class="form-control" name="category" id="category">
                            {{#categories}}
                                <option>{{this}}</option>
                            {{/categories}}
                        </select>
                    </div>
                    <div class="col-lg-1">
                        <label for="promotion" class="control-label">Prom</label>
                        <input type="checkbox" class="form-control" name="promotion" id="promotion" />
                    </div>
                    <div class="col-lg-1">
                        <label for="good_buy" class="control-label">Good</label>
                        <input type="checkbox" class="form-control" name="good_buy" id="good_buy" />
                    </div>
                    <div class="col-lg-12">
                        <label for="Comments" class="control-label">Comments</label>
                        <textarea class="form-control" placeholder="Comments" name="comments" id="comments"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                        <button class="pull-right btn btn-default" type="submit">Upsert</button>
            </div>
            </div>
        </div>
    </form>
</div>
<script>
    $("a#del-link").on("click", function (event) {
        event.preventDefault();
        var id = $(this).data("id");
        bootbox.confirm("Are you sure you want to delete this item?",
            function (result) {
                if (result) {
                    $.ajax(
                        {
                            url: id,
                            method: "DELETE",
                            success: function (data) {
                                $("#" + id).remove();
                            }
                        }
                    );
                }
            });
    });

    $("a#update-link").on('click', function (e) {
        e.preventDefault();
        $.ajax({
                    url: "detail/" + $(this).data("id"),
                    method: "GET",
                    success: function (data) {
                        $("#upsertModal .modal-body #id").val(data.id);
                        $("#upsertModal .modal-body #date").val(moment(data.date).utc().format("YYYY-MM-DD"));
                        $("#upsertModal .modal-body #product").val(data.product);
                        if (data.brand)
                            $("#upsertModal .modal-body #brand").val(data.brand._id);
                        $("#upsertModal .modal-body #upp").val(data.upp);
                        $("#upsertModal .modal-body #weight").val(data.weight);
                        $("#upsertModal .modal-body #unit").val(data.unit);
                        $("#upsertModal .modal-body #units_bought").val(data.units_bought);
                        $("#upsertModal .modal-body #unit_cost").val(data.unit_cost);
                        $("#upsertModal .modal-body #item_cost").val(data.item_cost);
                        $("#upsertModal .modal-body #reason").val(data.reason);
                        $("#upsertModal .modal-body #currency").val(data.currency);
                        $("#upsertModal .modal-body #address").val(data.address);
                        $("#upsertModal .modal-body #type").val(data.type);
                        $("#upsertModal .modal-body #category").val(data.category);
                        $("#upsertModal .modal-body #promotion").val(data.promotion);
                        $("#upsertModal .modal-body #good_buy").prop('checked', data.good_buy);
                        $("#upsertModal .modal-body #comments").prop('checked', data.comments);
                        $("#upsertModal").modal();
                    }
        });
    });
</script>