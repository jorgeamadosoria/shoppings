<div class="panel panel-black">
    <div class="panel-body">
        <form class="form-horizontal" enctype="application/x-www-form-urlencoded" action="" method="post">
            <div class="row">
                <div class="form-group col-lg-3">
                    <label for="date" class="control-label">Date</label> {{#if obj}}
                    <input class="form-control" type="date" placeholder="date" name="date" id="date" value="{{dateFormat obj.date " YYYY-MM-DD
                        "}}" /> {{else}}
                    <input class="form-control" type="date" placeholder="date" name="date" id="date" value="{{dateFormat now " YYYY-MM-DD
                        "}}" /> {{/if}}
                </div>
                <div class="form-group col-lg-3">
                    <label for="product" class="control-label">Product</label>
                    <input class="form-control" placeholder="product" name="product" id="product" value="{{obj.product}}" />
                </div>
                <div class="form-group col-lg-3">
                    <label for="brand" class="control-label">Brand</label>
                    <select class="form-control" name="brand" id="brand">
                        {{#if obj}}
                            {{#if obj.brand}}
                                <option value="{{obj.brand._id}}" selected>{{obj.brand.name}}</option>
                            {{/if}}
                        {{/if}}
                        
                        {{#brands}}
                            <option value="{{this._id}}">{{this.name}}</option>
                        {{/brands}}
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="form-group col-lg-3">
                    <label for="upp" class="control-label">Units per product</label>
                    <input class="form-control" placeholder="upp" name="upp" id="upp" value="{{obj.upp}}" />
                </div>
                <div class="form-group col-lg-3">
                    <label for="weight" class="control-label">Weight</label>
                    <input class="form-control" placeholder="weight" name="weight" id="weight" value="{{obj.weight}}" />
                </div>
                <div class="form-group col-lg-3">
                    <label for="unit" class="control-label">Unit</label>
                    <select class="form-control" name="unit" id="unit">
                        {{#units}}
                            <option>{{this}}</option>
                        {{/units}}
                        {{#if obj}}
                            <option selected >{{obj.unit}}</option>   
                        {{/if}}     
                    </select>
                </div>
                <div class="form-group col-lg-3">
                    <label for="units_bought" class="control-label">Units bought</label>
                    <input class="form-control" placeholder="units_bought" name="units_bought" id="units_bought" value="{{obj.units_bought}}"
                    />
                </div>
            </div>
            <div class="row">
                <div class="form-group col-lg-3">
                    <label for="unit_cost" class="control-label">Unit cost</label>
                    <input class="form-control" placeholder="unit_cost" name="unit_cost" id="unit_cost" value="{{obj.unit_cost}}" />
                </div>
                <div class="form-group col-lg-3">
                    <label for="item_cost" class="control-label">Item cost</label>
                    <input class="form-control" placeholder="item_cost" name="item_cost" id="item_cost" value="{{obj.item_cost}}" />
                </div>
                <div class="form-group col-lg-3">
                    <label for="reason" class="control-label">Reason</label>
                    <select class="form-control" name="reason" id="reason">
                        {{#reasons}}
                            <option>{{this}}</option>
                        {{/reasons}}
                        {{#if obj}}
                            <option selected >{{obj.reason}}</option>   
                        {{/if}}
                    </select>
                </div>
                <div class="form-group col-lg-3">
                    <label for="good_buy" class="control-label">Good buy</label> {{#if obj.good_buy}}
                    <input type="checkbox" class="form-control" name="good_buy" id="good_buy" checked/> {{else}}
                    <input type="checkbox" class="form-control" name="good_buy" id="good_buy" /> {{/if}}
                </div>
            </div>
            <div class="row">
                <div class="form-group col-lg-3">
                    <label for="promotion" class="control-label">Promotion</label> {{#if obj.promotion}}
                    <input type="checkbox" class="form-control" name="promotion" id="promotion" checked/> {{else}}
                    <input type="checkbox" class="form-control" name="promotion" id="promotion" /> {{/if}}
                </div>
                <div class="form-group col-lg-3">
                    <label for="address" class="control-label">Address</label>
                    <select class="form-control" name="address" id="address">
                        {{#addresses}}
                            <option value="{{this._id}}">{{this.fullAddress}}</option>
                        {{/addresses}}
                        {{#if obj}}
                            <option selected value="{{obj.address._id}}">{{obj.address.fullAddress}}</option>
                        {{/if}}
                    </select>
                </div>
                <div class="form-group col-lg-3">
                    <label for="type" class="control-label">Type</label>
                    <select class="form-control" name="type" id="type">
                        {{#types}}
                            <option>{{this}}</option>
                        {{/types}}
                        {{#if obj}}
                            <option selected >{{obj.type}}</option>   
                        {{/if}}     
                    </select>
                </div>
                <div class="form-group col-lg-3">
                    <label for="category" class="control-label">Category</label>
                    <select class="form-control" name="category" id="category">
                        {{#categories}}
                            <option>{{this}}</option>
                        {{/categories}}
                        {{#if obj}}
                            <option selected >{{obj.category}}</option>   
                        {{/if}}     
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="form-group col-lg-3">
                    <label for="Comments" class="control-label">Comments</label>
                    <input class="form-control" placeholder="Comments" name="comments" id="comments" value="{{obj.comments}}" />
                </div>
                <div class="form-group col-lg-3">
                    <label for="currency" class="control-label">Currency</label>
                    <select class="form-control" name="currency" id="currency">
                        {{#currencies}}
                            <option>{{this}}</option>
                        {{/currencies}}
                        {{#if obj}}
                            <option selected >{{obj.currency}}</option>   
                        {{/if}}     
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="form-group col-lg-12">
                    <div class="pull-right">
                        <button class="pull-right btn btn-default" type="submit">Upsert</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
<div class="panel panel-black">
    <div class="panel-body">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Product</th>
                    <th>Brand</th>
                    <th class="hidden-sm hidden-xs">Weight</th>
                    <th class="hidden-sm hidden-xs">Unit</th>
                    <th class="hidden-xs">Items</th>
                    <th class="hidden-xs">Item Cost</th>
                    <th>Total Cost</th>
                    <th class="hidden-xs">Address</th>
                    <th class="hidden-md hidden-sm hidden-xs">Type</th>
                    <th class="hidden-xs">Category</th>
                    <th class="hidden-md hidden-sm hidden-xs">Currency</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {{#list}}
                <tr id="{{_id}}">
                    <td><i class="{{status}}"></i>&nbsp;{{#if date}} {{dateFormat date "YYYY-MM-DD" ""}} {{/if}}
                    </td>
                    <td>{{product}}</td>
                    <td>{{brand.name}}</td>
                    <td class="hidden-sm hidden-xs">{{weight}}</td>
                    <td class="hidden-sm hidden-xs">{{unit}}</td>
                    <td class="hidden-xs">{{units_bought}}</td>
                    <td class="hidden-xs">{{item_cost}}</td>
                    <td>{{totalItemCost}}</td>
                    <td class="hidden-xs">{{address.fullAddress}}</td>
                    <td class="hidden-md hidden-sm hidden-xs">{{type}}</td>
                    <td class="hidden-xs">{{category}}</td>
                    <td class="hidden-md hidden-sm hidden-xs">{{currency}}</td>
                    <td><a id="del-link" data-id="{{_id}}" href=""><i class="fa fa-trash"></i></a>&nbsp;<a href="form?id={{_id}}"><i class="fa fa-pencil"></i></a>
                    </td>
                </tr>
                {{/list}}
            </tbody>
        </table>
    </div>
</div>

<script>
    $("a#del-link").on("click", function (event) {
        event.preventDefault();
        var id = $(this).data("id");
        bootbox.confirm("Are you sure you want to delete this item?",
            function (result) {
                if (result) {
                    $.ajax(
                        {
                            url: id,
                            method: "DELETE",
                            success: function (data) {
                                $("#" + id).remove();
                            }
                        }
                    );
                }
            });
    });


    $("a#del-link").on("click", function (event) {
        $.ajax(
            {
                url: $(this).data("id"),
                method: "DELETE",
                success: function (data) {
                    $("#item-" + $(this).data("id")).remove();
                }
            }
        );
    });

</script>